def FAILED_STAGE
pipeline {
	agent any
	stages {
		stage('Build') {
			steps {
				script {
					FAILED_STAGE=env.STAGE_NAME
					echo "Testing ${env.STAGE_NAME}"
				}
			}
		}
		stage('Test'){
			steps {
				script {
					FAILED_STAGE=env.STAGE_NAME
					echo "Testing ${env.STAGE_NAME}"
				}
			}
		}
		stage('Deploy') {
			steps {
				script {
					FAILED_STAGE=env.STAGE_NAME
					echo "Testing ${env.STAGE_NAME}"
				}
			}
		}
	}
	post {
		failure {
			mail to: 'sd.gcp.ae@gmail.com',
            		subject: "Failed Pipeline: ${currentBuild.fullDisplayName}",
             		body: "Something is wrong with ${env.BUILD_URL}"
		}
		success {
			echo 'I am sending a notification with success'
		}
	}
}
