def FAILED_STAGE
pipeline {
	agent any
	stages {
		stage('Build') {
			steps {
				script {
					FAILED_STAGE=env.STAGE_NAME
					echo "Testing ${env.STAGE_NAME}"
				}
			}
		}
		stage('Test'){
			steps {
				script {
					FAILED_STAGE=env.STAGE_NAME
					echo "Testing ${env.STAGE_NAME}"
				}
			}
		}
		stage('Deploy') {
			steps {
				script {
					FAILED_STAGE=env.STAGE_NAME
					echo "Testing ${env.STAGE_NAME}"
				}
			}
		}
	}
	post {
		failure {
			subject: "ERROR: Project name -> ${env.JOB_NAME}", 
			body: "<b>Example</b><br>\n<br>Project: ${env.JOB_NAME} <br>Build Number: ${env.BUILD_NUMBER} <br> URL de build: ${env.BUILD_URL}", 
			charset: 'UTF-8', 
			mimeType: 'text/html', 
			to: "sd.gcp.ae@gmail.com";
		}
		success {
			echo 'I am sending a notification with success'
		}
	}
}
